<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dynamic Topic Sentinel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --surface-gradient: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            --border-radius: 16px;
            --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        body { 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            color: #2d3748;
        }
        .container { max-width: 900px; }
        .gradient-text {
            background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text; font-weight: 700;
        }
        .card {
            background: var(--surface-gradient); border: 0; border-radius: var(--border-radius);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08); transition: var(--transition);
        }
        .card:hover { transform: translateY(-8px); box-shadow: 0 20px 60px rgba(102, 126, 234, 0.15); }
        .form-select, .form-control { border-radius: 12px; }
        .btn-primary {
            background: var(--primary-gradient); border: none; border-radius: 12px;
            font-weight: 600; transition: var(--transition);
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3); }
        .report-content { white-space: pre-wrap; line-height: 1.8; }
        .report-content h3, .report-content h4, .report-content h5 { margin-top: 1.5rem; font-weight: 600; }
        .list-group-item { border-radius: 12px; margin-bottom: 0.5rem; border: none; }
        .card-header { background: var(--primary-gradient); color: white; font-weight: 600; }
        .fade-in { animation: fadeInUp 0.8s ease forwards; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div class="container my-5">
        <div class="text-center mb-5">
            <h1 class="display-4 gradient-text mb-3">üß† Dynamic Topic Sentinel</h1>
            <p class="lead fs-5">Your personal AI research agent. Select your role and enter a topic to get a tailored, synthesized report.</p>
        </div>

        <div class="card shadow-lg mb-4">
            <div class="card-body p-4">
                <form id="research-form">
                    <div class="mb-3">
                        <label for="persona-select" class="form-label">Select Your Role</label>
                        <select class="form-select form-select-lg" id="persona-select">
                            <option value="default" selected>üë§ General User</option>
                            <option value="marketing_manager">üìà Marketing Manager</option>
                            <option value="academic_researcher">üéì Academic Researcher</option>
                            <option value="financial_investor">üí∞ Financial Investor</option>
                            <option value="content_creator">‚úçÔ∏è Content Creator</option>
                        </select>
                    </div>
                    <div class="input-group input-group-lg">
                        <input type="text" id="topic-input" class="form-control" placeholder="Enter a research topic..." required>
                        <button class="btn btn-primary px-4" type="submit" id="submit-button">
                            <i class="bi bi-search me-2"></i>Research
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div id="results-area" class="mt-5" style="display: none;">
            <div class="text-center p-4" id="spinner">
                <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;" role="status"></div>
                <p class="text-muted fw-medium">ü§ñ Agent is analyzing sources and synthesizing insights...</p>
            </div>



            <div id="report-card" class="card shadow-lg" style="display: none;">
                <div class="card-header">
                    <h4><i class="bi bi-graph-up-arrow me-2"></i>Intelligence Briefing</h4>
                </div>
                <div class="card-body report-content" id="report-content"></div>
            </div>

            <div id="sources-card" class="card shadow-lg mt-4" style="display: none;">
                <div class="card-header">
                    <h6><i class="bi bi-link-45deg me-2"></i>Research Sources</h6>
                </div>
                <ul class="list-group list-group-flush p-3" id="sources-list"></ul>
            </div>
        </div>
    </div>

    <script>
        const researchForm = document.getElementById('research-form');
        const resultsArea = document.getElementById('results-area');
        const spinner = document.getElementById('spinner');
        const reportCard = document.getElementById('report-card');
        const reportContent = document.getElementById('report-content');
        const sourcesCard = document.getElementById('sources-card');
        const sourcesList = document.getElementById('sources-list');
        const submitButton = document.getElementById('submit-button');

        function formatReport(text) {
            return text
                .replace(/### (.*?)$/gm, '<h5>$1</h5>')
                .replace(/## (.*?)$/gm, '<h4>$1</h4>')
                .replace(/# (.*?)$/gm, '<h3>$1</h3>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\* (.*?)$/gm, '<br>‚Ä¢ $1')
                .replace(/^- (.*?)$/gm, '<br>‚Ä¢ $1')
                .replace(/\n/g, '<br>');
        }

        function showLoadingState() {
            resultsArea.style.display = 'block';
            spinner.style.display = 'block';
            reportCard.style.display = 'none';
            sourcesCard.style.display = 'none';
            submitButton.disabled = true;
            submitButton.innerHTML = `<span class="spinner-border spinner-border-sm"></span> Researching...`;
        }

        function showSuccessState(data) {
            spinner.style.display = 'none';
            reportContent.innerHTML = formatReport(data.report);
            reportCard.style.display = 'block';
            reportCard.classList.add('fade-in');

            sourcesList.innerHTML = '';
            if (data.sources && data.sources.length > 0) {
                data.sources.forEach(url => {
                    const listItem = document.createElement('li');
                    listItem.className = 'list-group-item';
                    listItem.innerHTML = `<a href="${url}" target="_blank" rel="noopener noreferrer"><i class="bi bi-link-45deg me-2"></i>${url}</a>`;
                    sourcesList.appendChild(listItem);
                });
                sourcesCard.style.display = 'block';
                sourcesCard.classList.add('fade-in');
            }
            
            submitButton.disabled = false;
            submitButton.innerHTML = `<i class="bi bi-search me-2"></i>Research`;
        }

        function showErrorState(error) {
            spinner.style.display = 'none';
            submitButton.disabled = false;
            submitButton.innerHTML = `<i class="bi bi-search me-2"></i>Research`;
        }

        researchForm.addEventListener('submit', async function(event) {
            event.preventDefault();
            showLoadingState();

            try {
                const topic = document.getElementById('topic-input').value;
                const persona = document.getElementById('persona-select').value;
                
                const response = await fetch('/research', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ topic, persona })
                });

                if (!response.ok) throw new Error(`Server error (${response.status})`);
                
                const data = await response.json();

                if (!data || !data.report) throw new Error('Invalid or empty response from server');

                showSuccessState(data);

            } catch (error) {
                console.error('Error:', error);
                showErrorState(error);
            }
        });
    </script>
</body>
</html>